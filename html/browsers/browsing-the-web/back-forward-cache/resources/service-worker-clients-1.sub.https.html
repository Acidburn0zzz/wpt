<!doctype html>
<script src="/common/PrefixedLocalStorage.js"></script>
<script src="helper.sub.js"></script>
<iframe></iframe>
<script>
startRecordingEvents(['visibilitychange', 'pagehide', 'pageshow', 'load']);

runTest(
  () => {
    const iframe = document.querySelector('iframe');
    iframe.src = prefixedLocalStorage.url('https://{{host}}:{{ports[https][0]}}/html/browsers/browsing-the-web/back-forward-cache/resources/clients-matchall-iframe.html?key=clients-1');
    iframe.onload = () => {
      iframe.contentWindow.postMessage('start', '*');
      window.onmessage = () => {
        location.href = prefixedLocalStorage.url('https://{{hosts[alt][www]}}:{{ports[https][0]}}/html/browsers/browsing-the-web/back-forward-cache/resources/service-worker-clients-2.sub.https.html');
      };
    };
  },
  (isBFCached, observedEvents) => {
    prefixedLocalStorage.setItem(
      'result',
      JSON.stringify({
        isBFCached,
        observedEvents
        }));
  });
</script>
